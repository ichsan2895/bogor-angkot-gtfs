  </body>
  <script>
    function warp(x) {
      if (x<0) {
        return -Math.sqrt(Math.abs(x));
      } else {
        return Math.sqrt(x);
      }
    }

    function drawPoint(lon, lat, text) {
      var canvasWidth = 1000;
      var canvasHeight = 1000;
      var canvasScale = 1500*1000;

      // center around (-6.6, 106.8) which is right in the Kebun Raya (Bogor, Indonesia).
      var x = lat - 106.8;
      var y = lon + 6.6;

      var canvasX = (canvasWidth/2)+warp(canvasScale*x);
      var canvasY = (canvasHeight/2)-warp(canvasScale*y);
console.log(canvasX, canvasY);
      var c = document.getElementById("myCanvas");
      var ctx = c.getContext("2d");

      ctx.beginPath();
      ctx.arc(canvasX, canvasY, 5, 0, 2*Math.PI);
      ctx.stroke();
      ctx.font = "10px Arial";
      ctx.fillText(text,canvasX+8,canvasY+4);
    }

    function getPoints() {
      return new Promise(resolve => {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', './build/stopsPerRoute.json');
        xhr.onload = function() {
          console.log('resolving');
          resolve(JSON.parse(xhr.responseText));
        }
        xhr.send();
      });
    }

    var points;
    var routeNames = {};

    function drawRoute(routeName, dryRun) {
      var missing = [];
      for (var pointName in points[routeName]) {
        var coords = points[routeName][pointName];
        if (coords[0] == '-6.6') {
          console.log('missing', routeName, pointName);
          missing.push(pointName);
        } else {
          console.log('drawing', routeName, pointName, coords);
          if (!dryRun) {
            drawPoint(parseFloat(coords[0]), parseFloat(coords[1]), pointName);
          }
        }
      }
      return missing;
    }

    function drawAll(dryRun) {
      for (var routeName in points) {
        if (routeName.substring(0, 'AK-'.length) == 'AK-') {
          routeNames[routeName] = drawRoute(routeName, dryRun);
        } else {
          console.log('skipping', routeName);
        }
      }
    }

    // ...
    getPoints().then(gotPoints => {
      points = gotPoints;
      drawAll(true);
      console.log(routeNames);
    });
  </script>
</html>
